<!doctype html><html lang="ko"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<title>LunchSpot â€“ ì ì‹¬ ë§›ì§‘ ì•„ì¹´ì´ë¸Œ</title>
<style>
body{font-family:system-ui,-apple-system,Segoe UI,Roboto,'Noto Sans KR',sans-serif;margin:0;background:#f7f7f8}
.wrap{max-width:1100px;margin:24px auto;padding:0 16px}
header{display:flex;gap:12px;flex-wrap:wrap;align-items:flex-end;justify-content:space-between;margin-bottom:12px}
h1{font-size:20px;margin:0}.controls{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
input[type='text'],select{padding:8px 10px;border-radius:10px;border:1px solid #ddd;background:#fff}
input[type='range']{width:220px}.pill{padding:6px 10px;border:1px solid #ddd;border-radius:999px;background:#fff;font-size:12px;cursor:pointer}
.pill.on{background:#111;color:#fff}.grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px}
@media (max-width:800px){.grid{grid-template-columns:1fr}}.card{background:#fff;border:1px solid #e7e7ea;border-radius:16px;padding:14px}
.muted{color:#666;font-size:12px}.row{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:8px}
.tag{background:#f0f0f3;color:#444;padding:2px 6px;border-radius:999px;font-size:10px;margin-right:4px;display:inline-block}
.seg{display:inline-flex;border:1px solid #ddd;border-radius:12px;overflow:hidden;background:#fff}
.seg button{padding:6px 10px;border:0;background:transparent;cursor:pointer}.seg button.on{background:#111;color:#fff}
footer{text-align:center;margin:18px 0 8px;color:#777;font-size:12px}
.alert{background:#fff3cd;border:1px solid #ffeeba;color:#856404;padding:10px;border-radius:10px;margin:8px 0;font-size:12px}
.badge{display:inline-block;padding:2px 8px;border-radius:999px;background:#eef;border:1px solid #dde;color:#334;font-size:11px;margin-left:6px}
.kv{display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin-left:8px}
</style></head><body>
<div class="wrap">
<header><div><h1>ğŸ± LunchSpot â€“ ì ì‹¬ ë§›ì§‘ ì•„ì¹´ì´ë¸Œ</h1><div class="muted">ë°ì´í„°ê°€ ì´ íŒŒì¼ ì•ˆì— í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤. (ì†Œìš”ì‹œê°„ ê¸°ì¤€ í•„í„°)</div></div>
<div class="controls"><div class="seg"><button id="tab-rest" class="on">ì‹ë‹¹</button><button id="tab-cafe">ì¹´í˜</button></div>
<select id="sort"><option value="score">ì •ë ¬: ì ìˆ˜</option><option value="time">ì •ë ¬: ì†Œìš”ì‹œê°„</option><option value="wait">ì •ë ¬: ëŒ€ê¸°</option><option value="price">ì •ë ¬: ê°€ê²©</option></select>
<input id="q" type="text" placeholder="ê²€ìƒ‰: ì´ë¦„/ìŒì‹/íƒœê·¸"></div></header>
<section class="controls" style="margin-bottom:12px;">
  <div class="kv">ìµœëŒ€ ë„ë³´ì‹œê°„: <span id="tOut">15</span>ë¶„ <input id="t" type="range" min="3" max="30" step="1" value="15"></div>
  <div class="kv">ìµœëŒ€ ê°€ê²©: â‚©<span id="pOut">15000</span> <input id="p" type="range" min="4000" max="20000" step="500" value="15000"></div>
  <div class="kv">ìµœëŒ€ ëŒ€ê¸°: <span id="wOut">20</span>ë¶„ <input id="w" type="range" min="0" max="40" step="1" value="20"></div>
  <label class="kv" style="margin-left:0;"><input id="hideUnknownTime" type="checkbox"> ì†Œìš”ì‹œê°„ ì •ë³´ ì—†ëŠ” ê°€ê²Œ ìˆ¨ê¸°ê¸°</label>
</section>
<div class="muted" id="count"></div>
<div id="hint" class="alert" style="display:none;">ê°€ê²Œê°€ ì•ˆ ë³´ì´ë©´: (1) ê²€ìƒ‰ì°½ì„ ë¹„ìš°ê³  (2) ì†Œìš”ì‹œê°„ ìŠ¬ë¼ì´ë”ë¥¼ ì›€ì§ì—¬ ë³´ì„¸ìš”. (3) <b>ì†Œìš”ì‹œê°„ ì •ë³´ ì—†ëŠ” ê°€ê²Œ ìˆ¨ê¸°ê¸°</b> ì²´í¬ë¥¼ í•´ì œí•´ë³´ì„¸ìš”.</div>
<div class="grid" id="grid"></div>
<footer>ì ìˆ˜ = 0.35Â·ë§› + 0.25Â·ì†ë„ + 0.2Â·ê°€ì„±ë¹„ + 0.1Â·ê±´ê°• + 0.1Â·ì¾Œì  (1â€“5)</footer>
<script>
function normTags(v){ if(!v) return []; if(Array.isArray(v)) return v; return String(v).split(',').map(s=>s.trim()).filter(Boolean); }
function isFiniteNumber(n){ return typeof n==='number' && isFinite(n); }
function computeWalk(r){ 
  if(isFiniteNumber(r.walking_time_min)) return r.walking_time_min; 
  if(isFiniteNumber(r.distance_km)) return Math.round(r.distance_km*1000/80); // 80m/min í™˜ì‚°
  return undefined;
}
function clamp01(n){ return Math.max(0,Math.min(1,n)); }
function score5(r){ const t=clamp01((r.taste_rating_1_5||0)/5), s=clamp01((r.speed_rating_1_5||0)/5), v=clamp01((r.value_rating_1_5||0)/5), h=clamp01((r.health_rating_1_5||0)/5), c=clamp01((r.comfort_rating_1_5||0)/5); return +((0.35*t+0.25*s+0.2*v+0.1*h+0.1*c)*5).toFixed(2); }
function normalize(list){ return list.map(r=>({ ...r, tags:normTags(r.tags), walking_time_min:computeWalk(r), lunch_score:isFiniteNumber(r.lunch_score)?r.lunch_score:score5(r) })); }

let dataset='restaurants'; const $=sel=>document.querySelector(sel);
const q=$('#q'), sort=$('#sort'), t=$('#t'), p=$('#p'), w=$('#w'), tOut=$('#tOut'), pOut=$('#pOut'), wOut=$('#wOut'), grid=$('#grid'), count=$('#count'), tabRest=$('#tab-rest'), tabCafe=$('#tab-cafe'), hideUnknown=$('#hideUnknownTime'), hint=$('#hint');

function makeRenderer(RESTAURANTS, CAFES){
  function dataNow(){ return normalize(dataset==='cafes'?CAFES:RESTAURANTS); }
  function render(){
    tOut.textContent=t.value; pOut.textContent=p.value; wOut.textContent=w.value;
    const data=dataNow().filter(r=>{
      const wt = computeWalk(r); // ìš°ì„  ì†Œìš”ì‹œê°„ ê¸°ì¤€
      const passTime = (isFiniteNumber(wt) ? (wt <= +t.value) : !hideUnknown.checked);
      const passPrice = (isFiniteNumber(r.price_min_krw)?r.price_min_krw:0) <= +p.value;
      const passWait = (isFiniteNumber(r.lunch_peak_wait_min)?r.lunch_peak_wait_min:0) <= +w.value;
      const ql=q.value.trim().toLowerCase();
      const hay=[r.name,r.cuisine,r.area,r.signature_dish,r.address,(r.tags||[]).join(' ')].join(' ').toLowerCase();
      const passSearch = ql ? hay.includes(ql) : true;
      return passTime && passPrice && passWait && passSearch;
    }).sort((a,b)=> 
      sort.value==='score' ? (b.lunch_score||0)-(a.lunch_score||0) :
      sort.value==='time'  ? ((computeWalk(a)??999)-(computeWalk(b)??999)) :
      sort.value==='wait'  ? ((isFiniteNumber(a.lunch_peak_wait_min)?a.lunch_peak_wait_min:0)-(isFiniteNumber(b.lunch_peak_wait_min)?b.lunch_peak_wait_min:0)) :
                             ((isFiniteNumber(a.price_min_krw)?a.price_min_krw:0)-(isFiniteNumber(b.price_min_krw)?b.price_min_krw:0))
    );
    count.textContent=`${data.length} ê³³`;
    hint.style.display = data.length ? 'none' : 'block';
    grid.innerHTML=data.map(r=>`<div class="card"><div style="display:flex;justify-content:space-between;gap:8px;">
      <div><div style="font-weight:700;">${r.name??'â€”'}</div><div class="muted">${r.cuisine??'â€”'} Â· ${r.area??''}</div></div>
      <div style="text-align:right;"><div style="font-size:18px;font-weight:700;">${isFiniteNumber(r.lunch_score)?r.lunch_score.toFixed(1):'â€”'}</div><div class="muted">lunch score</div></div>
    </div>
    <div class="row">
      <div>ğŸ’¸ ê°€ê²©: â‚©${(r.price_min_krw??'â€”').toLocaleString?.('ko-KR')||r.price_min_krw??'â€”'}â€“â‚©${(r.price_max_krw??'â€”').toLocaleString?.('ko-KR')||r.price_max_krw??'â€”'}</div>
      <div>ğŸš¶ ì†Œìš”ì‹œê°„: ${(computeWalk(r)??'â€”')}ë¶„ ${isFiniteNumber(r.distance_km)?`(<span class="muted">${r.distance_km} km</span>)`:''}</div>
      <div>â±ï¸ ëŒ€ê¸°(í”¼í¬): ${r.lunch_peak_wait_min??'â€”'}ë¶„</div>
      <div>ğŸ¥— ì‹œê·¸ë‹ˆì²˜: ${r.signature_dish??'â€”'}</div>
    </div>
    <div style="margin-top:6px;">${(r.tags||[]).map(t=>`<span class="tag">${t}</span>`).join(' ')}</div>
    <div style="margin-top:8px;display:flex;gap:6px;flex-wrap:wrap;">${(r.latitude&&r.longitude)?`<a class="pill" href="https://www.google.com/maps/search/?api=1&query=${r.latitude},${r.longitude}" target="_blank">Google Maps</a>`:''}
      <a class="pill" href="https://map.naver.com/v5/search/${encodeURIComponent(r.name||'')}" target="_blank">Naver Map</a>${r.website?`<a class="pill" href="${r.website}" target="_blank">Website</a>`:''}</div>
    </div>`).join('');
  }
  return render;
}
</script><script>
const RESTAURANTS = [];
const CAFES = [];

const tabRest=document.getElementById('tab-rest'), tabCafe=document.getElementById('tab-cafe');
const render = makeRenderer(RESTAURANTS, CAFES);
[q,sort,t,p,w,hideUnknown].forEach(el=>el.addEventListener('input', ()=>render()));
tabRest.addEventListener('click',()=>{dataset='restaurants';tabRest.classList.add('on');tabCafe.classList.remove('on');render();});
tabCafe.addEventListener('click',()=>{dataset='cafes';tabCafe.classList.add('on');tabRest.classList.remove('on');render();});
render();
</script></div></body></html>
